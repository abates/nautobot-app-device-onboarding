---
device_onboarding:
  # use_textfsm: true
  hostname:
    jpath: "[*].hostname"
    command:
      command: "show version"
      use_textfsm: true
    post_processor: "{{ obj[0] | upper }}"
  serial:
    command:
      command: "show version"
      use_textfsm: true
    jpath: "[*].serial[0]"
  device_type:
    command:
      command: "show version"
      use_textfsm: true
    jpath: "[*].hardware[0]"
  mgmt_interface:
    command:
      command: "show interfaces"
      use_textfsm: true
    jpath: "[?ip_address=='{{ obj }}'].{name: interface, enabled: link_status}"
    post_processor: "{% for interface in obj %}{% if 'up' in interface['enabled'] %}{{ interface.name }}{% endif %}{% endfor %}"
  mask_length:
    command:
      command: "show interfaces"
      use_textfsm: true
    jpath: "[?ip_address=='{{ obj }}'].prefix_length"
    post_processor: "{{ obj | unique | first }}"
network_importer:
  # use_textfsm: true
  serial:
    command:
      command: "show version"
      use_textfsm: true
    jpath: "[*].serial[0]"
  interfaces:
    command:
      command: "show interfaces"
      use_textfsm: true
    jpath: "[*].[$interface$,hardware_type,ip_address,prefix_length,mac_address,mtu,description,link_status,vlan_id,vlan_id_inner,vlan_id_outer]"
    post_processor: "{{ obj | fix_interfaces | tojson }}"
